<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IIA006A</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body class="container mt-4 bg-dark text-light">
  <!-- Header -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <h1 class="navbar-brand">Inteligência Artificial</h1>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item text-end">
            <small class="text-secondary lh-1">
              Análise e Desenvolvimento de Sistemas - 6° Semestre, Manhã <br>
              Faculdade de Tecnologia de São Caetano do Sul
            </small>
          </li>
        </ul>
      </div>
    </nav>
    <hr>
  </header>

  <!-- Conteúdo -->
  <main class="container mt-5">
    <div class="container mt-2 mb-2">
      <h3 class="text-center mb-4">Rede Neural Artificial</h3>
      <p> Este é a simulação de uma rede neural artificial do tipo Perceptron supervisionada, iremos treiná-la com base
        nas entradas (&#120013;<sub>n</sub>), saída esperada (<i>d</i>) e taxa de aprendizado (&#951;) que você
        informar.
      </p>
    </div>

    <!-- Form para identificação das entradas e da saída esperada] -->
    <form id="perceptronForm" class="container mt-4 mb-4">
      <h5>Dados de Treinamento</h5>
      <div id="trainingInputs">
        <div class="input-group gap-5 mb-3">
          <input type="number" class="form-control" placeholder="x1" required>
          <input type="number" class="form-control" placeholder="x2" required>
          <input type="number" class="form-control" placeholder="x3" required>
          <input type="number" class="form-control" placeholder="resultado esperado" required>
          <button type="button" class="btn btn-danger"> <i class="bi bi-dash-circle"></i> </button>
        </div>
      </div>

      <button type="button" id="addRow" class="btn btn-success mb-3"> <i class="bi bi-plus-circle"></i> </button>

      <div class="row hstack gap-3">
        <!-- Taxa de aprendizado -->
        <div class="form-floating col-2 mb-3">
          <input id="taxaDeAprendizado" class="form-control" placeholder="taxa de aprendizado" type="number" step="0.01"
            required>
          <label for="taxaDeAprendizado" class="mx-2">Taxa de Aprendizagem</label>
        </div>

        <div class="col-2 form-check mb-3">
          <input type="checkbox" class="form-check-input" id="useBias">
          <label for="useBias" class="form-check-label">Usar Bias</label>
        </div>

        <button type="button" id="trainButton" class="col-2 btn btn-primary">Treinar Rede</button>
      </div>



    </form>

    <hr>
    <h2>Resultados</h2>
    <div id="results"></div>

    <hr>
    <h2>Teste</h2>
    <form id="testForm" class="container mt-4 mb-4">
      <div class="mb-3">
        <label for="testInput" class="form-label">Novo Conjunto de Entradas (x1, x2, x3)</label>
        <input type="number" class="form-control" id="testInput1" placeholder="x1" required>
        <input type="number" class="form-control" id="testInput2" placeholder="x2" required>
        <input type="number" class="form-control" id="testInput3" placeholder="x3" required>
      </div>
      <button type="button" id="testButton" class="btn btn-success">Testar</button>
    </form>
    <div id="testResult" class="mt-3"></div>
  </main>

  <!-- Footer -->
  <footer class="text-center mt-4 mb-4">
    <hr>
    <small class="text-secondary lh-sm">
      Bianca Letícia Floriano da Silva <br> RA: 1680482211022
    </small>
  </footer>

  <script>
    class Perceptron {
      constructor(taxaDeAprendizado, useBias) {
        this.weights = [0, 0, 0];
        this.bias = useBias ? 0 : null;
        this.taxaDeAprendizado = taxaDeAprendizado;
      }

      predict(inputs) {
        let sum = inputs.reduce((acc, val, idx) => acc + val * this.weights[idx], 0);
        if (this.bias !== null) sum += this.bias;
        return sum >= 0 ? 1 : 0;
      }

      train(data) {
        let iterations = 0;
        let errorExists;
        do {
          errorExists = false;
          data.forEach(({ inputs, expected }) => {
            const prediction = this.predict(inputs);
            const error = expected - prediction;

            if (error !== 0) {
              errorExists = true;
              inputs.forEach((input, idx) => {
                this.weights[idx] += this.taxaDeAprendizado * error * input;
              });
              if (this.bias !== null) {
                this.bias += this.taxaDeAprendizado * error;
              }
            }
          });
          iterations++;
        } while (errorExists && iterations < 1000); // Limite para evitar loops infinitos
        return iterations;
      }
    }

    let perceptron;

    // Adicionar nova linha de entrada
    document.getElementById("addRow").addEventListener("click", () => {
      const newRow = document.createElement("div");
      newRow.classList.add("input-group", "mb-3", "gap-5");
      newRow.innerHTML = `
        <input type="number" class="form-control" placeholder="x1" required>
        <input type="number" class="form-control" placeholder="x2" required>
        <input type="number" class="form-control" placeholder="x3" required>
        <input type="number" class="form-control" placeholder="resultado esperado" required>
        <button type="button" class="btn btn-danger removeRow"> <i class="bi bi-dash-circle"></i> </button>
      `;
      document.getElementById("trainingInputs").appendChild(newRow);
    });

    // Remover linha de entrada
    document.getElementById("trainingInputs").addEventListener("click", (e) => {
      if (e.target.classList.contains("removeRow")) {
        e.target.parentElement.remove();
      }
    });

    // Treinar a rede
    document.getElementById("trainButton").addEventListener("click", () => {
      const inputs = document.querySelectorAll("#trainingInputs .input-group");
      const trainingData = [];
      inputs.forEach((row) => {
        const [x1, x2, x3, yx] = Array.from(row.querySelectorAll("input")).map((input) =>
          parseFloat(input.value)
        );
        trainingData.push({ inputs: [x1, x2, x3], expected: yx });
      });

      const taxaDeAprendizado = parseFloat(document.getElementById("taxaDeAprendizado").value);
      const useBias = document.getElementById("useBias").checked;

      if (!trainingData.length || isNaN(taxaDeAprendizado)) {
        alert("Preencha todos os campos corretamente.");
        return;
      }

      perceptron = new Perceptron(taxaDeAprendizado, useBias);
      const iterations = perceptron.train(trainingData);

      let resultsHTML = `<p>Treinamento concluído em <strong>${iterations}</strong> iterações.</p>`;
      resultsHTML += `<p>Pesos finais: <strong>${perceptron.weights.join(", ")}</strong></p>`;
      if (useBias) resultsHTML += `<p>Bias final: <strong>${perceptron.bias}</strong></p>`;
      document.getElementById("results").innerHTML = resultsHTML;
    });

    // Testar nova entrada
    document.getElementById("testButton").addEventListener("click", () => {
      if (!perceptron) {
        alert("Treine a rede antes de realizar testes.");
        return;
      }

      const inputs = [
        parseFloat(document.getElementById("testInput1").value),
        parseFloat(document.getElementById("testInput2").value),
        parseFloat(document.getElementById("testInput3").value),
      ];

      if (inputs.some(isNaN)) {
        alert("Preencha todos os valores de entrada para o teste.");
        return;
      }

      const prediction = perceptron.predict(inputs);
      document.getElementById("testResult").innerHTML = `<p>Resultado da predição: <strong>${prediction}</strong></p>`;
    });
  </script>
</body>

</html>