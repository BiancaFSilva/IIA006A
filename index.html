<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualização de Grafo - BFS Passo a Passo</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network@9.0.4/dist/vis-network.min.js"></script>
    <link href="https://unpkg.com/vis-network@9.0.4/dist/vis-network.min.css" rel="stylesheet" type="text/css" />

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</head>

<body class="container">
    <div class="d-grid gap-2">
        <button class="btn btn-primary" type="button" onclick="startBFS()">Iniciar BFS</button>
        <div id="grafoPonderadoNaoOrientado" style="width: 800px; height: 600px;"></div>

        <div>
            <h3>Legenda</h3>
            <ul>
                <li><span style="color: #000000;">Preto</span>: Nó visitado</li>
                <li><span style="color: #7a7a7a;">Cinza</span>: Nó em processamento</li>
                <li><span style="color: #33ff55;">Vermelho</span>: Aresta visitada</li>
            </ul>
        </div>

        <div>
            <h3>Resultado do BFS</h3>
            <p>Fila final: <span id="filaFinal"></span></p>
            <p>Árvore de decisão: <span id="arvoreDecisao"></span></p>
            <p>Pais: <span id="pais"></span></p>
    </div>

    <script>
        // Definir nós e arestas para o grafo
        var nodes = new vis.DataSet([
            { id: 'Piracicaba', label: 'Piracicaba' },
            { id: 'Americana', label: 'Americana' },
            { id: 'Sumaré', label: 'Sumaré' },
            { id: 'Campinas', label: 'Campinas' },
            { id: 'Indaiatuba', label: 'Indaiatuba' },
            { id: 'Monte Mor', label: 'Monte Mor' },
            { id: 'Paulínea', label: 'Paulínea' },
            { id: 'Capivari', label: 'Capivari' },
            { id: 'Salto', label: 'Salto' },
            { id: 'Itú', label: 'Itú' },
            { id: 'Porto Feliz', label: 'Porto Feliz' },
            { id: 'Tietê', label: 'Tietê' },
            { id: 'Sorocaba', label: 'Sorocaba' },
            { id: 'Boituva', label: 'Boituva' },
            { id: 'Tatuí', label: 'Tatuí' }
        ]);

        var edges = new vis.DataSet([
            { from: 'Piracicaba', to: 'Americana', label: '30' },
            { from: 'Piracicaba', to: 'Capivari', label: '32' },
            { from: 'Piracicaba', to: 'Tietê', label: '35' },
            { from: 'Americana', to: 'Sumaré', label: '18' },
            { from: 'Americana', to: 'Paulínea', label: '22' },
            { from: 'Capivari', to: 'Monte Mor', label: '15' },
            { from: 'Capivari', to: 'Salto', label: '25' },
            { from: 'Capivari', to: 'Tietê', label: '30' },
            { from: 'Tietê', to: 'Porto Feliz', label: '30' },
            { from: 'Tietê', to: 'Tatuí', label: '25' },
            { from: 'Campinas', to: 'Paulínea', label: '25' },
            { from: 'Campinas', to: 'Sumaré', label: '23' },
            { from: 'Campinas', to: 'Monte Mor', label: '22' },
            { from: 'Campinas', to: 'Indaiatuba', label: '20' },
            { from: 'Indaiatuba', to: 'Salto', label: '20' },
            { from: 'Itú', to: 'Salto', label: '10' },
            { from: 'Itú', to: 'Porto Feliz', label: '12' },
            { from: 'Itú', to: 'Sorocaba', label: '8' },
            { from: 'Boituva', to: 'Sorocaba', label: '23' },
            { from: 'Boituva', to: 'Porto Feliz', label: '12' },
            { from: 'Boituva', to: 'Tatuí', label: '17' }
        ]);

        var container = document.getElementById('grafoPonderadoNaoOrientado');
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
            edges: {
                labelHighlightBold: true,
                font: {
                    align: 'middle'
                }
            },
            nodes: {
                shape: 'dot',
                size: 16,
                font: {
                    size: 14
                }
            },
            physics: {
                enabled: true
            }
        };
        var network = new vis.Network(container, data, options);

        // Função para executar o BFS de forma incremental
        function startBFS() {
            let grafo = {
                'Piracicaba': ['Americana', 'Capivari', 'Tietê'],
                'Americana': ['Piracicaba', 'Sumaré', 'Paulínea'],
                'Sumaré': ['Americana', 'Campinas'],
                'Campinas': ['Paulínea', 'Sumaré', 'Monte Mor', 'Indaiatuba'],
                'Indaiatuba': ['Campinas', 'Salto'],
                'Monte Mor': ['Campinas', 'Capivari'],
                'Paulínea': ['Americana', 'Campinas'],
                'Capivari': ['Piracicaba', 'Monte Mor', 'Salto', 'Tietê'],
                'Salto': ['Capivari', 'Indaiatuba', 'Itú'],
                'Itú': ['Salto', 'Porto Feliz', 'Sorocaba'],
                'Porto Feliz': ['Itú', 'Tietê', 'Boituva'],
                'Tietê': ['Piracicaba', 'Capivari', 'Porto Feliz', 'Tatuí'],
                'Sorocaba': ['Itú', 'Boituva'],
                'Boituva': ['Sorocaba', 'Porto Feliz', 'Tatuí'],
                'Tatuí': ['Tietê', 'Boituva']
            };

            let origem = 'Piracicaba';
            let cor = {};
            let fila = [];
            let pais = {};

            // Inicializando todos os nós com a cor "branco"
            Object.keys(grafo).forEach(cidade => {
                cor[cidade] = "BRANCO";
                pais[cidade] = null;
            });

            // BFS inicial
            cor[origem] = "CINZA";
            fila.push(origem);

            let index = 0;

            function executarPasso() {
                if (fila.length === 0) return; // Termina se a fila estiver vazia

                let u = fila.shift(); // Desenfileira
                highlightNode(u, "CINZA");

                setTimeout(() => {
                    for (let v of grafo[u]) {
                        if (cor[v] === "BRANCO") {
                            cor[v] = "CINZA";
                            highlightEdge(u, v);
                            fila.push(v);
                            pais[v] = u;
                        }
                    }
                    cor[u] = "PRETO";
                    highlightNode(u, "PRETO");

                    // Próximo passo
                    index++;
                    if (fila.length > 0) {
                        setTimeout(executarPasso, 1000); // Executa o próximo passo em 1 segundo
                    }
                }, 1000);
            }

            // Inicia a execução passo a passo
            executarPasso();
        }

        // Funções auxiliares para destacar nós e arestas
        function highlightNode(nodeId, color) {
            nodes.update({ id: nodeId, color: color === "CINZA" ? '#7a7a7a' : '#000000' });
        }

        function highlightEdge(from, to) {
            let edge = edges.get({
                filter: function (edge) {
                    return (edge.from === from && edge.to === to) || (edge.from === to && edge.to === from);
                }
            });
            if (edge.length > 0) {
                edges.update({ id: edge[0].id, color: { color: '#33ff55' } });
            }
        }

        let resultadoBFS = grafo.bfs('Piracicaba');
        document.getElementById('filaFinal').innerText = resultadoBFS.fila;
        document.getElementById('arvoreDecisao').innerText = resultadoBFS.arvoreDecisao;
        document.getElementById('pais').innerText = resultadoBFS.pais;
    </script>
</body>

</html>